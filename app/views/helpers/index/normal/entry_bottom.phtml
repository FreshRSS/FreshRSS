<?php
	$sharing = array();
	if (FreshRSS_Auth::hasAccess()) {
		$sharing = FreshRSS_Context::$user_conf->sharing;
	}

	$bottomline_read = FreshRSS_Context::$user_conf->bottomline_read;
	$bottomline_favorite = FreshRSS_Context::$user_conf->bottomline_favorite;
	$bottomline_sharing = FreshRSS_Context::$user_conf->bottomline_sharing && (count($sharing) > 0);
	$bottomline_tags = FreshRSS_Context::$user_conf->bottomline_tags;
	$bottomline_date = FreshRSS_Context::$user_conf->bottomline_date;
	$bottomline_link = FreshRSS_Context::$user_conf->bottomline_link;
?><ul class="horizontal-list bottom"><?php
	if (FreshRSS_Auth::hasAccess()) {
		if ($bottomline_read) {
			?><li class="item manage"><?php
				$arUrl = array('c' => 'entry', 'a' => 'read', 'params' => array('id' => $this->entry->id()));
				if ($this->entry->isRead()) {
					$arUrl['params']['is_read'] = 0;
				}
				?><a class="read" href="<?php echo Minz_Url::display($arUrl); ?>"><?php
					echo _i($this->entry->isRead() ? 'read' : 'unread'); ?></a><?php
			?></li><?php
		}
		if ($bottomline_favorite) {
			?><li class="item manage"><?php
				$arUrl = array('c' => 'entry', 'a' => 'bookmark', 'params' => array('id' => $this->entry->id()));
				if ($this->entry->isFavorite()) {
					$arUrl['params']['is_favorite'] = 0;
				}
				?><a class="bookmark" href="<?php echo Minz_Url::display($arUrl); ?>"><?php
					echo _i($this->entry->isFavorite() ? 'starred' : 'non-starred'); ?></a><?php
			?></li><?php
		}
	} ?>
	<li class="item"><?php
			if ($bottomline_sharing) {
		?><div class="dropdown">
			<div id="dropdown-share-<?php echo $this->entry->id();?>" class="dropdown-target"></div>
			<a class="dropdown-toggle" href="#dropdown-share-<?php echo $this->entry->id();?>">
				<?php echo _i('share'); ?>
				<?php echo _t('index.share'); ?>
			</a>

			<ul class="dropdown-menu">
				<li class="dropdown-close"><a href="#close">❌</a></li><?php
					$link = $this->entry->link();
					$title = $this->entry->title() . ' · ' . $this->feed->name();
					foreach (FreshRSS_Context::$user_conf->sharing as $share_options) {
						$share = FreshRSS_Share::get($share_options['type']);
						if ($share === null) {
							continue;
						}
						$share_options['link'] = $link;
						$share_options['title'] = $title;
						$share->update($share_options);
				?><li class="item share">
					<?php if ('GET' === $share->method()) {?>
						<a target="_blank" rel="noreferrer" href="<?php echo $share->url(); ?>"><?php echo $share->name(); ?></a>
					<?php } else {?>
						<a href="POST"><?php echo $share->name(); ?></a>
						<form method="POST" data-url="<?php echo $share->url(); ?>">
							<input type="hidden" value="<?php echo $link; ?>" name="<?php echo $share->field(); ?>"/>
						</form>
					<?php } ?>
				</li><?php
					}
			?></ul>
		</div>
		<?php } ?>
	</li><?php
	$tags = $bottomline_tags ? $this->entry->tags() : null;
	if (!empty($tags)) {
	?><li class="item">
		<div class="dropdown">
			<div id="dropdown-tags-<?php echo $this->entry->id();?>" class="dropdown-target"></div>
			<?php echo _i('tag'); ?>
			<a class="dropdown-toggle" href="#dropdown-tags-<?php echo $this->entry->id();?>"><?php
				echo _t('index.tag.related');
			?></a>
			<ul class="dropdown-menu">
				<li class="dropdown-close"><a href="#close">❌</a></li><?php
				foreach($tags as $tag) {
					?><li class="item"><a href="<?php echo _url('index', 'index', 'search', '#' . htmlspecialchars_decode($tag, ENT_QUOTES)); ?>"><?php echo $tag; ?></a></li><?php
				} ?>
			</ul>
		</div>
	</li><?php
	}
	if ($bottomline_date) {
		?><li class="item date"><?php echo $this->entry->date(); ?></li><?php
	}
	if ($bottomline_link) {
		?><li class="item link"><a target="_blank" rel="noreferrer" href="<?php echo $this->entry->link(); ?>"><?php echo _i('link'); ?></a></li><?php
	} ?>
</ul>
